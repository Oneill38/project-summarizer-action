name: Done Summarizer

on:
  - push
  # schedule:
  #   # * is a special character in YAML so you have to quote this string
  #   # Run this task mondays at 12:00 AM
  #   - cron: "* * * * 1"

jobs:
  fetch-done-issues:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: GitHub CLI authentication
        run: echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token

      - name: Install Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: "2.7"

      - name: Install octokit gem
        run: gem install octokit

      - name: Fetches issues from GitHub
        run: ruby .github/workflows/fetch-done-issues.rb > project_weely_summary.md
        env:
          GITHUB_TOKEN: "${{secrets.GITHUB_TOKEN}}"
          REPO_NWO: "jeffrafter/project-summarizer-action"
          PROJECT_NAME: "Cool Tasks"

      - name: Upload project summary file
        uses: actions/upload-artifact@v2
        with:
          name: project summary
          path: project_weely_summary.md
          retention-days: 3

      - name: Download project summary
        uses: actions/download-artifact@v2
        with:
          name: project summary

      - name: Create Issue From File
        uses: peter-evans/create-issue-from-file@v3
        with:
          title: Weekly Summary of Done Issues
          content-filepath: project_weely_summary.md
          labels: |
            report
            automated issue

